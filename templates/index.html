<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="ajNGV2_lZAx4Jrs20pvFiopVAevaxv-jEx37Itqoajk" />
  <title>عادل ضرغام</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <!-- إضافة مكتبة Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
  <!-- رأس الصفحة -->
  <header class="main-header">
    <div class="container">
      <h1 class="site-title">عادل ضرغام</h1>
      <nav>
        <ul class="nav-links">
          <li><a href="{{ url_for('home') }}" class="active">الرئيسية</a></li>
          <li><a href="{{ url_for('about') }}">نبذة</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- المقدمة -->
  <main>
    <section class="intro">
      <h2 class="intro-title">كاتب وناقد أدبي وأستاذ جامعي</h2>
      <div class="intro-content">
        <img src="{{ url_for('static', filename='Uploads/adel.jpeg') }}" alt="صورة عادل ضرغام" class="author-img">
        <div class="author-bio">
          <p>د. عادل ضرغام، أستاذ الأدب والنقد في كلية دار العلوم - جامعة الفيوم، له العديد من المؤلفات الأدبية والنقدية المتميزة.</p>
          <!-- إضافة العداد -->
          <p class="visitor-counter">عدد الزوار: <span id="visitor-count">0</span></p>
        </div>
      </div>
    </section>

    <!-- قسم الأعمال -->
    <section class="works">
      <h2 class="section-title">أعمال عادل ضرغام</h2>
      <div class="books-grid" id="books-grid">
        {% if books %}
          {% for book in books %}
            <div class="book">
              {% if book.image %}
                <img src="{{ book.image }}" alt="{{ book.title }}" class="book-img">
              {% else %}
                <img src="{{ url_for('static', filename='images/placeholder.jpg') }}" alt="صورة افتراضية" class="book-img">
              {% endif %}
              <div class="book-info">
                <p><strong>{{ book.title }}</strong></p>
                <a href="{{ url_for('view_book', book_id=book.id) }}" class="read-more">اقرأ المزيد</a>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <p>لا توجد كتب متاحة حاليًا.</p>
        {% endif %}
      </div>
    </section>
  </main>

  <!-- التذييل -->
  <footer>
    <div class="container">
      <p>© 2025 عادل ضرغام - جميع الحقوق محفوظة</p>
    </div>
  </footer>

  <!-- سكريبت العداد -->
  <script>
    // إعداد Supabase Client
    const supabaseUrl = 'YOUR_SUPABASE_URL'; // استبدل بـ URL الخاص بك
    const supabaseKey = 'YOUR_SUPABASE_KEY'; // استبدل بـ Public Key الخاص بك
    const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

    // دالة لزيادة عدد الزوار
    async function incrementVisitorCount() {
      try {
        // استرجاع العداد الحالي من العمود visitor_count
        const { data, error } = await supabase
          .from('site_data') // غيّر site_data باسم الجدول بتاعك
          .select('visitor_count')
          .eq('id', 1)
          .single();

        if (error) throw error;

        // إذا لم يكن هناك سجل، أنشئ واحدًا
        let newCount = 1;
        if (data) {
          newCount = data.visitor_count + 1;
          // تحديث العداد
          const { error: updateError } = await supabase
            .from('site_data')
            .update({ visitor_count: newCount })
            .eq('id', 1);

          if (updateError) throw updateError;
        } else {
          // إنشاء سجل جديد
          const { error: insertError } = await supabase
            .from('site_data')
            .insert([{ id: 1, visitor_count: 1 }]);

          if (insertError) throw insertError;
        }

        // عرض العداد على الصفحة
        document.getElementById('visitor-count').textContent = newCount;
      } catch (error) {
        console.error('خطأ:', error.message);
        document.getElementById('visitor-count').textContent = 'خطأ في تحميل العداد';
      }
    }

    // استدعاء الدالة عند تحميل الصفحة
    window.onload = incrementVisitorCount;
  </script>
</body>
</html>
